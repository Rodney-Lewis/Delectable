<div class="container">
   <form *ngIf="ngInited" [formGroup]="form" (ngSubmit)="submitForm()">
      <h3 *ngIf=!editRecipe>Create recipe</h3>
      <h3 *ngIf=editRecipe>Edit recipe</h3>
      <div class="row">
         <div class="col-lg">
            <div formGroupName="image" class="form-group">
               <label for="thumbnail">Thumbnail</label>
               <input type="file" class="form-control-file" id="thumbnail" formControlName="imageSourceFile"
                  accept="image/png, image/jpeg, image/jpg" (change)="onFileChange($event)" hidden>
               <img [src]="previewImage" (click)="clickElementById('thumbnail')" class="img-fluid">
               <small id="thumbnailHelp" class="form-text text-muted">Accepted formats: png, jpeg and jpg</small>
               <div *ngIf=invalidImageType class="validator">
                  Invalid image type.
               </div>
               <div *ngIf=invalidImageSize class="validator">
                  10Mb size exceeded, upload a lower resolution image.
               </div>
            </div>
         </div>
         <div class="col-lg">
            <div formGroupName="element" class="form-group">
               <input class="form-control" id="imageSource" formControlName="imageSource" type="text" hidden>
               <div class="row">
                  <div class="col-lg">
                     <label for="name">Name</label>
                     <span *ngIf="formFieldRequired('element.name')" class="validator">
                        (Required)
                     </span>
                     <input type="text" class="form-control" id="name" formControlName="name" placeholder="Name"
                        [ngClass]="{'is-invalid': formFieldRequired('element.name')}">
                  </div>
               </div>
               <div class="row">
                  <div class="col-lg">
                     <label for="source">Source</label>
                     <span *ngIf="formFieldRequired('element.source')" class="validator">
                        (Required)
                     </span>
                     <input type="text" class="form-control" id="source" formControlName="source"
                        placeholder="https://www.google.com"
                        [ngClass]="{'is-invalid': formFieldRequired('element.source')}">
                  </div>
               </div>
               <div class="row">
                  <div class="col">
                     <label for="description">Description</label>
                     <span *ngIf="formFieldRequired('element.description')" class="validator">
                        (Required)
                     </span>
                     <textarea class="form-control" rows="4" formControlName="description"
                        [ngClass]="{'is-invalid': formFieldRequired('element.description')}"></textarea>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div formGroupName="element" class="form-group">
         <div class="row">
            <div class="col">
               <h5>Ingredients</h5>
            </div>
         </div>
         <div formArrayName="ingredients">
            <div class="row">
               <div class="col">
                  <div *ngFor="let ingredient of form.get('element.ingredients').controls; let i = index"
                     formGroupName="{{i}}">
                     <div class="row">
                        <div class="col-md-5">
                           <label for="name">Ingredient</label>
                           <span *ngIf="formFieldRequired('element.ingredients.'+i+'.name')" class="validator">
                              (Required)
                           </span>

                            <div class="autocomplete" style="width:300px;"></div>
                           <input type="text" class="form-control" id="name{{i}}"
                              (input)="pantryAutoComplete('name'+i)"
                              [ngClass]="{'is-invalid': formFieldRequired('element.ingredients.'+i+'.name')}"
                              (blur)="setFormPantryValue(i)">


                           <!--
                           <input type="number" id="realName{{i}}" value="" class="form-control" formControlName="name"
                              hidden>

                           <datalist id="items">
                              <ng-container *ngFor="let pantryItem of pantryItemList">
                                 <option *ngIf="pantryItem.brand" label="{{pantryItem.name}} ({{pantryItem.brand}})">{{pantryItem.id}}</option>
                                 <option *ngIf="!pantryItem.brand" label="{{pantryItem.name}}">{{pantryItem.id}}</option>
                              </ng-container>
                           </datalist>
                           -->
                        </div>
                        <div class="col">
                           <label for="measurement">Measurement</label>
                           <span *ngIf="formFieldRequired('element.ingredients.'+i+'.measurement')" class="validator">
                              (Required)
                           </span>
                           <span *ngIf="formFieldRegex('element.ingredients.'+i+'.measurement')" class="validator">
                              (Incorrect format)
                           </span>
                           <input type="text" class="form-control" id="measurement" formControlName="measurement"
                              [ngClass]="{'is-invalid': formFieldRequired('element.ingredients.'+i+'.measurement') || formFieldRegex('element.ingredients.'+i+'.measurement')}"
                              placeholder="e.g. 1.25, 1/2, 10">
                        </div>
                        <div class="col">
                           <label for="unit">Unit</label>
                           <span *ngIf="formFieldRequired('element.ingredients.'+i+'.unit')" class="validator">
                              (Required)
                           </span>
                           <select class="form-control" id="unit" formControlName="unit"
                              [ngClass]="{'is-invalid': formFieldRequired('element.ingredients.'+i+'.unit')}">
                              <option *ngFor="let unit of units" [value]=unit>{{unit}}</option>
                           </select>
                        </div>
                        <div class=" col-auto mt-auto end-col-sm-gutter">
                           <button class="btn btn-danger key" type="button" (click)=removeIngredient(i)>-</button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row mt-3 justify-content-end">
               <div class="col-auto">
                  <button class="btn btn-primary key" type="button" (click)=addIngredient()>+</button>
               </div>
            </div>
         </div>
      </div>

      <div formGroupName="element" class="form-group">
         <div class="row">
            <div class="col">
               <h5>Directions</h5>
            </div>
         </div>
         <div class="row">
            <div class="col-sm">
               <label>Prep time</label>
               <div class="row">
                  <div class="col begin-col-sm-gutter">
                     <label for="prepTimeHour">Hours</label>
                     <input class="form-control" id="prepTimeHour" formControlName="prepTimeHour" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeHour')}" min="0" nax="100">
                  </div>
                  <div class="col mid-col-sm-gutter">
                     <label for="prepTimeMinute">Minutes</label>
                     <input class="form-control" id="prepTimeMinute" formControlName="prepTimeMinute" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeMinute')}" min="0" max="59">
                  </div>
                  <div class="col end-col-sm-gutter">
                     <label for="prepTimeSecond">Seconds</label>
                     <input class="form-control" id="prepTimeSecond" formControlName="prepTimeSecond" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeSecond')}" min="0" max="59">
                  </div>
               </div>
               <div *ngIf="formFieldMin('element.prepTimeHour')" class="validator">
                  Prep time hours can not be less then 0.
               </div>
               <div *ngIf="formFieldMin('element.prepTimeMinute')" class="validator">
                  Prep time minutes can not be less then 0.
               </div>
               <div *ngIf="formFieldMax('element.prepTimeMinute')" class="validator">
                  Prep time minutes can not be greater then 59.
               </div>
               <div *ngIf="formFieldMin('element.prepTimeSecond')" class="validator">
                  Prep time seconds can not be less then 0.
               </div>
               <div *ngIf="formFieldMax('element.prepTimeSecond')" class="validator">
                  Prep time seconds can not be greater then 59.
               </div>
            </div>
            <div class="col-sm">
               <label>Cook time</label>
               <div class="row">
                  <div class="col begin-col-sm-gutter">
                     <label for="cookTimeHour">Hours</label>
                     <input class="form-control" id="cookTimeHour" formControlName="cookTimeHour" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeHour')}" min="0">
                  </div>
                  <div class="col mid-col-sm-gutter">
                     <label for="cookTimeMinute">Minutes</label>
                     <input class="form-control" id="cookTimeMinute" formControlName="cookTimeMinute" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeMinute')}" min="0">
                  </div>
                  <div class="col end-col-sm-gutter">
                     <label for="cookTimeSecond">Seconds</label>
                     <input class="form-control" id="cookTimeSecond" formControlName="cookTimeSecond" type="number"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeSecond')}" min="0">
                  </div>
               </div>
               <div *ngIf="formFieldMin('element.cookTimeHour')" class="validator">
                  Cook time hours can not be less then 0.
               </div>
               <div *ngIf="formFieldMin('element.cookTimeMinute')" class="validator">
                  Cook time minutes can not be less then 0.
               </div>
               <div *ngIf="formFieldMax('element.cookTimeMinute')" class="validator">
                  Cook time minutes can not be greater then 59.
               </div>
               <div *ngIf="formFieldMin('element.cookTimeSecond')" class="validator">
                  Cook time seconds can not be less then 0.
               </div>
               <div *ngIf="formFieldMax('element.cookTimeSecond')" class="validator">
                  Cook time seconds can not be greater then 59.
               </div>
            </div>
         </div>
         <div formArrayName="directions" class="mt-3">
            <div *ngFor="let direction of form.get('element.directions').controls; let i = index" formGroupName="{{i}}">
               <div class="row">
                  <div class="col begin-col-sm-gutter">
                     <label for="instruction">Step {{direction.controls.step.value}}</label>
                     <span *ngIf="formFieldRequired('element.directions.'+i+'.instruction')" class="validator">
                        (Required)
                     </span>
                     <textarea class="form-control" id="instruction" formControlName="instruction" rows="2"
                        [ngClass]="{'is-invalid': formFieldRequired('element.directions.'+i+'.instruction')}"></textarea>
                  </div>
                  <div class="col-auto mt-5">
                     <button class="btn btn-danger key" type="button" (click)=removeDirection(direction)>-</button>
                  </div>
               </div>
            </div>
            <div class="row justify-content-end mt-3 ml-auto">
               <div class="col-auto">
                  <button class="btn btn-primary key" type="button" (click)=addDirection()>+</button>
               </div>
            </div>
         </div>
      </div>
      <div class="row mt-3 mb-3">
         <div class="col d-flex justify-content-end">
            <button *ngIf=editRecipe class="btn btn-primary" type="submit">Confirm edit</button>
            <button *ngIf=!editRecipe class="btn btn-primary" type="submit">Create recipe</button>
         </div>
      </div>
      {{form.value | json}}
   </form>
</div>