<div class="container">
    <form *ngIf="getFormGroupComponent('element.name')" [formGroup]="form" (ngSubmit)="submitForm()">
        <h3 *ngIf=!edit>Create new recipe</h3>
        <h3 *ngIf=edit>Edit recipe</h3>

        <div formGroupName="element">
            <div class="form-row form-group">
                <div class="col">
                    <label for="name">Name</label>
                    <span *ngIf="formFieldRequired('element.name')" class="validator">
                        (Required)
                    </span>
                    <input type="text" class="form-control" id="name" formControlName="name"
                        [ngClass]="{'is-invalid': formFieldRequired('element.name')}">
                </div>
            </div>
            <div class="form-row form-group">
                <div class="col">
                    <label for="source">Source</label>
                    <small class="text-muted">
                        Optional
                    </small>
                    <input type="text" class="form-control" id="source" formControlName="source">
                </div>
            </div>
            <div class="form-row form-group">
                <div class="col">
                    <label for="description">Description</label>
                    <small class="text-muted">
                        Optional
                    </small>
                    <textarea class="form-control" rows="4" formControlName="description"></textarea>
                </div>
            </div>
            <div class="form-row form-group">
                <div class="col">
                    <label for="servings">Number of servings</label>
                    <span *ngIf="formFieldMin('element.servings')" class="validator">
                        Servings can not be less then 0.
                    </span>
                    <span *ngIf="formFieldMax('element.servings')" class="validator">
                        Servings can not be greater then 99.
                    </span>
                    <input type="number" class="form-control" id="servings" formControlName="servings"
                        [ngClass]="{'is-invalid': formFieldInvalid('element.servings')}" min="0" nax="99">
                </div>
            </div>
        </div>

        <div formGroupName="element" class="form-group">
            <div class="form-row">
                <div class="col">
                    <label>Prep time</label>
                </div>
            </div>
            <div class="form-row">
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="prepTimeHour">Hr</label>
                        </div>
                        <input class="form-control" id="prepTimeHour" formControlName="prepTimeHour" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeHour')}" min="0" nax="72">
                    </div>
                </div>
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="prepTimeMinute">Min</label>
                        </div>
                        <input class="form-control" id="prepTimeMinute" formControlName="prepTimeMinute" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeMinute')}" min="0" max="59">
                    </div>
                </div>
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="prepTimeSecond">Sec</label>
                        </div>
                        <input class="form-control" id="prepTimeSecond" formControlName="prepTimeSecond" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.prepTimeSecond')}" min="0" max="59">
                    </div>
                </div>
                <div *ngIf="formFieldMin('element.prepTimeHour')" class="validator">
                    Prep time hours can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.prepTimeHour')" class="validator">
                    Prep time hours can not be greater then 72.
                </div>
                <div *ngIf="formFieldMin('element.prepTimeMinute')" class="validator">
                    Prep time minutes can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.prepTimeMinute')" class="validator">
                    Prep time minutes can not be greater then 59.
                </div>
                <div *ngIf="formFieldMin('element.prepTimeSecond')" class="validator">
                    Prep time seconds can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.prepTimeSecond')" class="validator">
                    Prep time seconds can not be greater then 59.
                </div>
            </div>
        </div>

        <div formGroupName="element" class="form-group">
            <div class="form-row">
                <div class="col">
                    <label>Cook time</label>
                </div>
            </div>
            <div class="form-row">
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="cookTimeHour">Hr</label>
                        </div>
                        <input class="form-control" id="cookTimeHour" formControlName="cookTimeHour" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeHour')}" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="cookTimeMinute">Min</label>
                        </div>
                        <input class="form-control" id="cookTimeMinute" formControlName="cookTimeMinute" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeMinute')}" min="0">
                    </div>
                </div>
                <div class="col">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="cookTimeSecond">Sec</label>
                        </div>
                        <input class="form-control" id="cookTimeSecond" formControlName="cookTimeSecond" type="number"
                            [ngClass]="{'is-invalid': formFieldInvalid('element.cookTimeSecond')}" min="0">
                    </div>
                </div>
                <div *ngIf="formFieldMin('element.cookTimeHour')" class="validator">
                    Cook time hours can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.cookTimeHour')" class="validator">
                    Cook time hours can not be greater then 72.
                </div>
                <div *ngIf="formFieldMin('element.cookTimeMinute')" class="validator">
                    Cook time minutes can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.cookTimeMinute')" class="validator">
                    Cook time minutes can not be greater then 59.
                </div>
                <div *ngIf="formFieldMin('element.cookTimeSecond')" class="validator">
                    Cook time seconds can not be less then 0.
                </div>
                <div *ngIf="formFieldMax('element.cookTimeSecond')" class="validator">
                    Cook time seconds can not be greater then 59.
                </div>
            </div>
        </div>

        <div formGroupName="image" class="form-group">
            <input type="file" class="form-control-file" id="thumbnail" formControlName="imageSourceFile"
                accept="image/png, image/jpeg, image/jpg" (change)="onFileChange($event)" hidden>
            <div *ngIf=previewImage>
                <div class="form-row">
                    <div class="col">
                        <img [src]="previewImage" (click)="clickElementById('thumbnail')" class="img-fluid">
                    </div>
                </div>
            </div>
            <div *ngIf=!previewImage class="thumbnailNoPreview rounded" (click)="clickElementById('thumbnail')">
                <div class="center">
                    <div class="row justify-content-center">
                        <div class="col-auto">
                            <svg width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-camera" fill="currentColor"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M15 12V6a1 1 0 0 0-1-1h-1.172a3 3 0 0 1-2.12-.879l-.83-.828A1 1 0 0 0 9.173 3H6.828a1 1 0 0 0-.707.293l-.828.828A3 3 0 0 1 3.172 5H2a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z" />
                                <path fill-rule="evenodd"
                                    d="M8 11a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                <path d="M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z" />
                            </svg>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-auto">
                            <p>Upload image</p>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf=invalidImageType class="validator">
                Invalid image type.
            </div>
            <div *ngIf=invalidImageSize class="validator">
                10Mb size exceeded, upload a lower resolution image.
            </div>
        </div>

        <div formGroupName="element">
            <div class="form-row">
                <div class="col">
                    <label>Ingredients</label>
                </div>
            </div>
            <div formArrayName="ingredients">
                <div class="form-row form-group"
                    *ngFor="let ingredient of form.get('element.ingredients').controls; let i = index"
                    [formGroupName]=i>
                    <div class="col">
                        <input appAutoRemoveIngredient [formClassReference]=this [id]=i type="text"
                            class="form-control ingredientInputs" formControlName="displayValue">
                    </div>
                    <div class="col-auto mt-auto mb-auto">
                        <button class="btn btn-sm btn-danger" type="button" (click)=removeIngredient(i)>x</button>
                    </div>
                </div>
            </div>
            <div class="form-row form-group">
                <div class="col">
                    <textarea appAutoAddIngredient [formClassReference]=this inputClassReference=ingredientInputs rows="1" type="text"
                        class="form-control" placeholder="Begin typing or paste a list of ingredients..."></textarea>
                </div>
            </div>
        </div>

        <div formGroupName="element">
            <div class="form-row">
                <div class="col">
                    <label>Directions</label>
                </div>
            </div>
            <div formArrayName="directions">
                <div class="form-row form-group"
                    *ngFor="let direction of form.get('element.directions').controls; let i = index" [formGroupName]=i>
                    <div class="col-auto">
                        <label for="instruction">{{direction.controls.step.value}}</label>
                    </div>
                    <div class="col">
                        <textarea appAutoResizeTextfield appAutoRemoveDirection [formClassReference]=this [id]=i
                            class="form-control instructionInputs" formControlName="instruction" rows="1"></textarea>
                    </div>
                    <div class="col-auto mt-auto mb-auto">
                        <button class="btn btn-sm btn-danger" type="button" (click)=removeDirection(i)>x</button>
                    </div>
                </div>
                <div class="form-row form-group">
                    <div class="col">
                        <textarea appAutoAddDirection [formClassReference]=this inputClassReference=instructionInputs rows="1"
                            class="form-control"
                            placeholder="Begin typing or paste a list of instructions..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-row mb-2">
            <div class="col d-flex justify-content-end">
                <button *ngIf=edit class="btn btn-primary" type="submit">Confirm edit!</button>
                <button *ngIf=!edit class="btn btn-primary" type="submit">Create recipe!</button>
            </div>
        </div>
        <div *ngIf=debugJson>
            {{form.value | json}}
        </div>
    </form>
</div>